<!DOCTYPE html>
<html>
<head>
    <title>Organization Chart</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/sankey.js"></script>
    <script src="https://code.highcharts.com/modules/organization.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    
    <style>
        .highcharts-figure,
        .highcharts-data-table table {
            min-width: 360px;
            max-width: 800px;
            margin: 1em auto;
        }

        .highcharts-data-table table {
            font-family: Verdana, sans-serif;
            border-collapse: collapse;
            border: 1px solid #ebebeb;
            margin: 10px auto;
            text-align: center;
            width: 100%;
            max-width: 500px;
        }

        .highcharts-data-table caption {
            padding: 1em 0;
            font-size: 1.2em;
            color: #555;
        }

        .highcharts-data-table th {
            font-weight: 600;
            padding: 0.5em;
        }

        .highcharts-data-table td,
        .highcharts-data-table th,
        .highcharts-data-table caption {
            padding: 0.5em;
        }

        .highcharts-data-table thead tr,
        .highcharts-data-table tr:nth-child(even) {
            background: #f8f8f8;
        }

        .highcharts-data-table tr:hover {
            background: #f1f7ff;
        }

        #container h4 {
            text-transform: none;
            font-size: 14px;
            font-weight: normal;
        }

        #container p {
            font-size: 13px;
            line-height: 16px;
        }

        @media screen and (max-width: 600px) {
            #container h4 {
                font-size: 2.3vw;
                line-height: 3vw;
            }

            #container p {
                font-size: 2.3vw;
                line-height: 3vw;
            }
        }
    </style>

</head>
<body>
    <figure class="highcharts-figure">
        <div id="container"></div>
        <p class="highcharts-description">
            Organization charts are a common case of hierarchical network charts,
            where the parent/child relationships between nodes are visualized.
            Highcharts includes a dedicated organization chart type that streamlines
            the process of creating these types of visualizations.
        </p>
    </figure>

    <script>
        function loadAndParseCSV(filePath) {
            fetch(filePath)
                .then(response => response.text())
                .then(csv => {
                    // Simplified CSV Parsing for Debugging
                    const rows = csv.trim().split("\n");
                    const headers = rows.shift().split(",");
                    const data = rows.map(row => {
                        const values = row.split(",");
                        return {
                            id: values[0].trim(),
                            name: values[1].trim(),
                            title: values[2].trim(),
                            parentId: values[3].trim(),
                        };
                    });
        
                    console.log("Parsed CSV Data:", data);
        
                    // Prepare data for Highcharts
                    const seriesData = data.filter(item => item.parentId).map(item => [item.parentId, item.id]);
                    const nodesData = data.map(item => ({ id: item.id, title: item.title, name: item.name }));
        
                    console.log("Series Data:", seriesData);
                    console.log("Nodes Data:", nodesData);
        
                    // Highcharts Initialization with Parsed Data
                    Highcharts.chart('container', {
                        chart: {
                            height: 600,
                            inverted: true,
                            type: 'organization'
                        },
                        title: {
                            text: 'Highcharts Org Chart'
                        },
                        series: [{
                            type: 'organization',
                            name: 'Organization',
                            keys: ['from', 'to'],
                            data: seriesData,
                            nodes: nodesData,
                            levels: [{
                                level: 0,
                                color: 'silver',
                                dataLabels: {
                                    color: 'black'
                                },
                                height: 25
                            }],
                            colorByPoint: false,
                            color: '#007ad0',
                            dataLabels: {
                                color: 'white'
                            },
                            borderColor: 'white',
                            nodeWidth: 65
                        }],
                        exporting: {
                            allowHTML: true,
                            buttons: {
                                exportButton: {
                                    text: 'Download 16:9',
                                    onclick: function() {
                                        this.exportChart({ 
                                            width: 1920, 
                                            sourceWidth: 1920, 
                                            sourceHeight: 1080 
                                        });
                                    }
                                }
                            }
                        }
                    });
                });
        }
        
        loadAndParseCSV('data/org_data_000001.csv');
        </script>
        

</body>
</html>
